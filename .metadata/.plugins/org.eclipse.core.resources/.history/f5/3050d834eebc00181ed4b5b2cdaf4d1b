package controller;

import java.awt.BasicStroke;
import java.awt.Color;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;

import model.BoardModel;
import model.Direction;
import model.Node;
import model.NodeSet;
import model.Piece;
import view.MyWindow;

public class GameController {
	MyWindow theView;
	BoardModel theModel;
	MyWindow myWindow;
	
	public GameController(MyWindow theView, BoardModel theModel) {

		preparePlayers();
		
		
		this.theView = theView;
		this.theModel = theModel;
		
		this.theView.boardView.addDragAndDropListener(new DragAndDropListener());
		System.out.println("paintGrid");
		
		// TODO: tell the View to create the Grid with the nodes and the playerView with the piecesToSet with the data from the model
		
	}
	
	public void createNodes() {
		// 	// index works as following:
	    //	0---------1---------2
		//	|		  |	    	|
		//	|  3------4------5  |
		//	|  |	  |      |  |
		//	|  |   6--7--8   |  |
		//  9-10--11	 12-13-14
		//  |  |  15-16--17  |  |
		//  |  |      |      |  |
		//  |  18----19-----20	|
		//	|		  |			|
		//	21-------22--------23
		
		Node[] nodeList = new Node[24];
		int x = 10;
		int y = 10;
		int offSet = 50;
		for(int i = 0; i < nodeList.length; i++) {
			nodeList[i] = new Node(x * i + offSet, y * i + offSet, i);
		}
		
		Node one = new Node(50,50,0);
		Node two = new Node(250, 50, 1);
		Node three = new Node(450, 50, 2);
		Node four = new Node(130, 130, 3);
		Node five = new Node(250, 130, 4);		
	}
	
	public void createNodeSets() {
		int index = 0; // index of the nodes
		int dist = 3; // distance between nodes, this gets decremented after each iteration of the loop
		
		NodeSet[] nodeSets = new NodeSet[16]; // all nodeSets
		int nodeSetindex = 0; // index of the nodeSets
		
		Node firstNode = null;
		
		for(int i = 0; i < 3; i++) {
			firstNode = new Node(i, i, index);
			
			
			
		}
		
	}
	
	public Node createNode(Direction d, Node lastNode, int index, int dist) {
		switch(d) {
		case TOP:
			return new Node(lastNode.getX(), lastNode.getY() - dist, index);
		case RIGHT:
			return new Node(lastNode.getX() + dist, lastNode.getY(), index);
		case BOTTOM:
			return new Node(lastNode.getX(), lastNode.getY() + dist, index);
		case LEFT:
			return new Node(lastNode.getX() - dist, lastNode.getY(), index);
		}
		return null; // could not create node
	}
	
	public void paintGrid() {
		try {
			Thread.sleep(20);
		} catch (InterruptedException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		Graphics2D g2d = (Graphics2D) this.theView.boardView.getGraphics();

		g2d.setStroke(new BasicStroke(10)); // line thickness
		g2d.setColor(Color.BLACK);
		
	// draw grid	
		// outer ring
		g2d.drawLine(50, 50, 450, 50);
		g2d.drawLine(450, 50, 450, 450);
		g2d.drawLine(450, 450, 50, 450);
		g2d.drawLine(50, 50, 50, 450);
		
		// middle ring
		g2d.drawLine(130, 130, 370, 130);
		g2d.drawLine(130, 130, 130, 370);
		g2d.drawLine(130, 370, 370, 370);
		g2d.drawLine(370, 130, 370, 370);
		
		// center ring
		g2d.drawLine(210, 210, 290, 210);
		g2d.drawLine(290, 210, 290, 290);
		g2d.drawLine(290, 290, 210, 290);
		g2d.drawLine(210, 290, 210, 210);
		
		// ring connections
		g2d.drawLine(50, 250, 210, 250);
		g2d.drawLine(250, 50, 250, 210);
		g2d.drawLine(290, 250, 450, 250);
		g2d.drawLine(250, 450, 250, 290);
		
	// draw pieces 
		// locations per index:
		// 0 = 50,50
		// 1 = 250,50
		// etc.
		// find a solution to render this efficiently and dyncamically
		
	}
	
	public void draw(Graphics g, Piece[] board) {
		for (Piece piece : board) {
			switch(piece.belongsTo) {
			case PLAYER1: 
				//g.drawRect(piece.index, y, width, height);
				break;
			case PLAYER2:
				
				break;
				
			case NOPLAYER:
				
				break;
			default: 
				
				break;
			}
		}
	}
	
	class DragAndDropListener implements MouseListener {
		
		@Override
		public void mouseClicked(MouseEvent e) {
			System.out.println("MouseClicked: " +e.getY() + " | " + e.getX());
			
			// TODO: move or set piece if possible
		}

		@Override
		public void mousePressed(MouseEvent e) {
			System.out.println("MousePressed: " +e.getY() + " | " + e.getX());
			// TODO: move or set piece if possible
		}

		@Override
		public void mouseReleased(MouseEvent e) {
			System.out.println("MouseReleased: " +e.getY() + " | " + e.getX());
			// TODO: move or set piece if possible
		}

		@Override
		public void mouseEntered(MouseEvent e) {
			System.out.println("MouseEntered: " +e.getY() + " | " + e.getX());
			// TODO: move or set piece if possible
		}

		@Override
		public void mouseExited(MouseEvent e) {
			System.out.println("MouseExited: " + e.getY() + " | " + e.getX());
			// TODO: move or set piece if possible
		}
	}
	
	public void preparePlayers() {
		
		
	}
	
	public void runGame() {
		// Phase 1 
		// Set Pieces
		
		// 1. set Message: its whites turn, you have to set a piece to the board
		// 2. wait for playerInput ( drag & drop ) 
		
		// Phase 2 
		// Move Pieces
		
		// Phase 3 (End-Phase)
		// Jump with Pieces
	}
	
	
	
}
